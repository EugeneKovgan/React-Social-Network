"use strict";(self.webpackChunkreact_social_network=self.webpackChunkreact_social_network||[]).push([[271],{271:function(e,s,n){n.r(s),n.d(s,{default:function(){return f}});var a=n(982),t=n(885),r={messages:"ChatPage_messages__Qg2LH",message:"ChatPage_message__42e2b",textBlock:"ChatPage_textBlock__Slh-z",header_block:"ChatPage_header_block__VcFu+",footer_block:"ChatPage_footer_block__HH-tW",info_block:"ChatPage_info_block__rSiUD",addMessageForm:"ChatPage_addMessageForm__tlWzm"},o=n(657),c=n(791),l=n(810),i=n(184),u=function(){var e=(0,c.useState)(null),s=(0,t.Z)(e,2),n=s[0],a=s[1];return(0,c.useEffect)((function(){var e,s=function(){console.log("close WS"),setTimeout(n,3e3)};function n(){var n,t;null===(n=e)||void 0===n||n.removeEventListener("close",s),null===(t=e)||void 0===t||t.close(),(e=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx")).addEventListener("close",s),a(e)}return n(),function(){e.removeEventListener("close",s),e.close()}}),[]),(0,i.jsxs)("div",{className:r.chat,children:[(0,i.jsx)(h,{wsChanel:n}),(0,i.jsx)(d,{wsChanel:n})]})},d=function(e){var s=e.wsChanel,n=(0,c.useState)([]),o=(0,t.Z)(n,2),u=o[0],d=o[1];return(0,c.useEffect)((function(){var e=function(e){var s=JSON.parse(e.data);d((function(e){return[].concat((0,a.Z)(e),(0,a.Z)(s))}))};return null===s||void 0===s||s.addEventListener("message",e),function(){null===s||void 0===s||s.removeEventListener("message",e)}}),[s]),(0,i.jsx)("div",{className:r.messages,children:(0,a.Z)(u).reverse().map((function(e){return(0,i.jsx)(v,{props:e},(0,l.Z)())}))})},v=function(e){var s=e.props;return(0,i.jsxs)("div",{className:r.message,children:[(0,i.jsxs)("div",{className:r.info_block,children:[(0,i.jsx)("img",{className:r.post_avatar,src:s.photo?s.photo:o,alt:"photo"}),(0,i.jsx)("p",{children:s.userName})]}),(0,i.jsxs)("div",{className:r.textBlock,children:[(0,i.jsx)("div",{className:r.header_block,children:(0,i.jsx)("p",{children:s.message})}),(0,i.jsx)("div",{className:r.footer_block})]})]})},h=function(e){var s=e.wsChanel,n=(0,c.useState)(""),a=(0,t.Z)(n,2),o=a[0],l=a[1],u=(0,c.useState)("pending"),d=(0,t.Z)(u,2),v=d[0],h=d[1];(0,c.useEffect)((function(){var e=function(){h("ready")};return null===s||void 0===s||s.addEventListener("open",e),function(){null===s||void 0===s||s.removeEventListener("open",e)}}),[s]);return(0,i.jsxs)("div",{className:r.addMessageForm,children:[(0,i.jsx)("textarea",{onChange:function(e){return l(e.currentTarget.value)},value:o}),(0,i.jsx)("button",{disabled:null===s||"ready"!==v,onClick:function(){o&&(null===s||void 0===s||s.send(o),l(""))},children:"add"})]})},f=function(){return(0,i.jsx)("div",{children:(0,i.jsx)(u,{})})}}}]);
//# sourceMappingURL=271.f2ed7e8c.chunk.js.map